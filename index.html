<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="theme-color" content="#fff6c9">
  <title>ì§€ë‹ˆì§± ê°ì‚¬ì¼ê¸°</title>

  <link rel="manifest" href="manifest.json">
  <link rel="icon" href="icons/icon-192.png" sizes="192x192">

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Jua&family=Gowun+Dodum&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="styles.css">

  <style>
    /* ê°•ì œ: í•œ ë²ˆì— í•œ í˜ì´ì§€ë§Œ ë³´ì´ê²Œ */
    .page{display:none} .page.active{display:block}
  </style>
</head>

<body>
  <header class="app-header">
    <div class="title-area">
      <h1 class="logo">ì§€ë‹ˆì§± ê°ì‚¬ì¼ê¸°</h1>

      <div class="header-right">
        <div class="header-auth">
          <span id="authMiniState" class="muted">ë¡œê·¸ì•„ì›ƒ ìƒíƒœ</span>
          <button id="authMiniLogin" class="mini-btn">ë¡œê·¸ì¸</button>
          <button id="authMiniLogout" class="mini-btn hidden">ë¡œê·¸ì•„ì›ƒ</button>
        </div>

        <nav class="tabs">
          <a href="#/daily" class="tab-btn" id="tab-daily">ë°ì¼ë¦¬</a>
          <a href="#/weekly" class="tab-btn" id="tab-weekly">ìœ„í´ë¦¬</a>
          <a href="#/search" class="tab-btn" id="tab-search">ê²€ìƒ‰</a>
          <a href="#/settings" class="tab-btn" id="tab-settings">ì„¤ì •/ë°±ì—…</a>
        </nav>
      </div>
    </div>
  </header>

  <main id="app-main">
    <!-- Daily Page -->
    <section id="page-daily" class="page active">
      <div class="date-row">
        <button id="prevDay" class="btn">&lt;</button>
        <input type="date" id="dailyDate">
        <button id="nextDay" class="btn">&gt;</button>
        <button id="todayBtn" class="btn outline">ì˜¤ëŠ˜</button>
        <span id="dailyDateText" class="date-text"></span>
      </div>

      <div class="card">
        <h2>ğŸª ì˜¤ëŠ˜ì˜ ì§ˆë¬¸</h2>
        <div class="qbox">
          <textarea id="questionText" class="auto" readonly></textarea>
          <div class="q-actions actions-spaced">
            <button id="btnAnotherQ" class="btn">ë‹¤ë¥¸ ì§ˆë¬¸</button>
          </div>
        </div>
        <label class="lbl">ë‹µë³€</label>
        <textarea id="answerText" class="auto" placeholder="ì§ˆë¬¸ì— ëŒ€í•œ ë‚˜ì˜ ë‹µì„ ì ì–´ë³´ì„¸ìš”."></textarea>
      </div>

      <div class="card">
        <h2>ğŸ§  ê°ì •ì¼ê¸°</h2>
        <p class="muted">ì‚¬ê±´ì„ ì‚¬ì‹¤ëŒ€ë¡œ ì ê³ , ê·¸ë•Œì˜ ìƒê°ê³¼ ê°ì •ì„ êµ¬ë¶„í•´ ë³¸ ë’¤ ê²°ê³¼ë¥¼ ê°„ë‹¨íˆ ë‚¨ê²¨ë³´ì„¸ìš”.</p>
        <label class="lbl">ì‚¬ê±´</label>
        <textarea id="eventField" class="auto" placeholder="ì˜¤ëŠ˜ ë¬´ìŠ¨ ì¼ì´ ìˆì—ˆë‚˜ìš”?"></textarea>
        <label class="lbl">ìƒê°</label>
        <textarea id="thoughtField" class="auto" placeholder="ê·¸ë•Œ ì–´ë–¤ ìƒê°ì´ ë“¤ì—ˆë‚˜ìš”?"></textarea>
        <label class="lbl">ê°ì •</label>
        <textarea id="feelingField" class="auto" placeholder="ê°ì •ì˜ ê°•ë„/ì´ìœ ë¥¼ í•¨ê»˜ ì ì–´ë³´ì„¸ìš”."></textarea>
        <label class="lbl">ê²°ê³¼</label>
        <textarea id="resultField" class="auto" placeholder="ê·¸ ê²°ê³¼ ë‚˜ëŠ” ì–´ë–»ê²Œ í–‰ë™í–ˆë‚˜ìš”?"></textarea>
      </div>

      <div class="card">
        <h2>ğŸŒ¼ ê°ì‚¬ì¼ê¸°</h2>
        <ol class="gratitude-list">
          <li><input type="text" id="grat1" placeholder="ì‘ì€ ê²ƒë„ ì¢‹ì•„ìš”."></li>
          <li><input type="text" id="grat2" placeholder="ì‚¬ëŒ/í–‰ë™/í–‰ìš´ ë“± ë¬´ì—‡ì´ë“ ."></li>
          <li><input type="text" id="grat3" placeholder="ì˜¤ëŠ˜ì„ ì¢‹ê²Œ ë§Œë“  ê²ƒ."></li>
        </ol>
      </div>

      <div class="card">
        <h2>ğŸ“” ì¼ìƒì¼ê¸°</h2>
        <textarea id="dailyNote" class="auto" placeholder="ì§§ê²Œ ìš”ì•½í•˜ê±°ë‚˜, ê¸¸ê²Œ ììœ ë¡­ê²Œ ì ì–´ë„ ì¢‹ì•„ìš”."></textarea>
      </div>

      <div class="card">
        <h2>ğŸ·ï¸ íƒœê·¸</h2>
        <input type="text" id="tagsField" placeholder="#ê°€ì¡±, #ì—…ë¬´ ì²˜ëŸ¼ ì‰¼í‘œë¡œ êµ¬ë¶„">
      </div>

      <div class="btn-row end actions-spaced" id="dailyActions">
        <button id="saveDaily" class="btn primary">ì €ì¥</button>
        <button id="clearDaily" class="btn danger">ì§€ìš°ê¸°</button>
        <span id="statusDaily" class="muted">ë¶ˆëŸ¬ì˜´</span>
      </div>
    </section>

    <!-- Weekly Page -->
    <section id="page-weekly" class="page">
      <div class="date-row">
        <button id="prevWeek" class="btn">&lt;</button>
        <input type="week" id="weekPicker">
        <button id="nextWeek" class="btn">&gt;</button>
        <button id="thisWeekBtn" class="btn outline">ì´ë²ˆ ì£¼</button>
        <span id="weekText" class="date-text"></span>
      </div>

      <div class="card">
        <h2>âœ… ë¯¸ì…˜ (ì²´í¬ë°•ìŠ¤)</h2>
        <div id="missionList"></div>
        <div class="add-mission">
          <input type="text" id="newMission" placeholder="ë¯¸ì…˜ ì¶”ê°€">
          <button id="addMission" class="btn">+ ì¶”ê°€</button>
        </div>
      </div>

      <div class="card">
        <h2>ğŸ«¶ ì˜¤ëŠ˜ì˜ ë¬¸êµ¬</h2>
        <textarea id="healingText" class="auto" placeholder="ì˜¤ëŠ˜ì˜ ë¬¸êµ¬"></textarea>
        <div class="btn-row actions-spaced">
          <button id="randomHealing" class="btn">ëœë¤</button>
          <button id="saveWeekly" class="btn primary">ì €ì¥</button>
          <button id="clearWeekly" class="btn danger">ì§€ìš°ê¸°</button>
        </div>
        <button id="startCopy" class="btn link">âœï¸ í•„ì‚¬ ì‹œì‘</button>
        <textarea id="copyArea" class="auto hidden" placeholder="ë¬¸êµ¬ë¥¼ ë”°ë¼ ì ì–´ë³´ì„¸ìš”."></textarea>
      </div>
    </section>

    <!-- Search Page -->
    <section id="page-search" class="page">
      <div class="card">
        <h2>ğŸ” ê²€ìƒ‰</h2>
        <input type="text" id="searchInput" placeholder="í‚¤ì›Œë“œ ë˜ëŠ” #íƒœê·¸ (ì˜ˆ: ë³´ê³ ì„œ, #ì—…ë¬´)">
        <div class="btn-row actions-spaced">
          <button id="searchBtn" class="btn">ê²€ìƒ‰</button>
          <button id="searchClear" class="btn">ì§€ìš°ê¸°</button>
        </div>
      </div>
      <div class="card">
        <h3>ê²°ê³¼</h3>
        <div id="searchResults"></div>
      </div>
    </section>

    <!-- Settings Page -->
    <section id="page-settings" class="page">
      <div class="card">
        <h2>ğŸ” ë¡œê·¸ì¸</h2>
        <div class="btn-row actions-spaced">
          <button id="openLogin" class="btn">ë¡œê·¸ì¸</button>
          <button id="btnSignOut" class="btn outline">ë¡œê·¸ì•„ì›ƒ</button>
        </div>
        <p class="muted" id="authState">ë¡œê·¸ì•„ì›ƒ ìƒíƒœ</p>
      </div>

      <div class="card">
        <h2>ğŸ“¦ ë°±ì—…/ë³µì›</h2>
        <div class="btn-row actions-spaced">
          <button id="exportJSON" class="btn">JSON íŒŒì¼ë¡œ ì €ì¥</button>
          <button id="shareJSON" class="btn">JSON ê³µìœ (ì¹´í†¡ ë“±)</button>
        </div>
        <div class="import-row">
          <input type="file" id="importFile" accept=".json"/>
          <button id="importJSON" class="btn">JSON ê°€ì ¸ì˜¤ê¸°</button>
        </div>
        <div class="btn-row actions-spaced">
          <button id="refreshCache" class="btn outline">ìºì‹œ ìƒˆë¡œê³ ì¹¨(ì—…ë°ì´íŠ¸)</button>
          <button id="resetLocal" class="btn danger">ë¡œì»¬ ë°ì´í„° ì´ˆê¸°í™”</button>
        </div>
      </div>
    </section>
  </main>

  <footer class="app-footer">
    <small>ì˜¤í”„ë¼ì¸ + í´ë¼ìš°ë“œ ë™ê¸°í™” Â· v2.3.2</small>
  </footer>

  <!-- ë¡œê·¸ì¸ ëª¨ë‹¬ -->
  <div id="loginModal" class="modal">
    <div class="modal-panel">
      <h3>ë¡œê·¸ì¸</h3>
      <label class="lbl">ì´ë©”ì¼</label>
      <input type="email" id="loginEmail" placeholder="you@example.com">
      <label class="lbl">ë¹„ë°€ë²ˆí˜¸</label>
      <input type="password" id="loginPwd" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
      <div class="btn-row actions-spaced">
        <button id="modalSignIn" class="btn primary">ë¡œê·¸ì¸</button>
        <button id="modalSignUp" class="btn">íšŒì›ê°€ì…</button>
        <button id="modalClose" class="btn">ë‹«ê¸°</button>
      </div>
      <p id="loginMsg" class="muted"></p>
    </div>
  </div>

  <!-- Firebase compat SDK (ì•ˆì •) -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <!-- ì•± ìŠ¤í¬ë¦½íŠ¸ (ì¼ë°˜ defer, ëª¨ë“ˆ ì•„ë‹˜) -->
  <script src="app.js?v=232" defer></script>

  <script>
    // ê°•ì œë¡œ ì˜ˆì „ ì„œë¹„ìŠ¤ì›Œì»¤/ìºì‹œ ì œê±° (GitHub Pages ìºì‹œ ê¼¬ì„ ë°©ì§€)
    (function(){
      if('serviceWorker' in navigator){
        navigator.serviceWorker.getRegistrations().then(rs=>rs.forEach(r=>r.unregister()));
        if(window.caches && caches.keys) caches.keys().then(keys=>keys.forEach(k=>caches.delete(k)));
      }
      // íƒ­ ë¼ìš°íŒ… ê¸°ë³¸ ê°€ë™
      function show(name){
        document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
        document.querySelector('#page-'+(name||'daily')).classList.add('active');
        document.querySelectorAll('.tab-btn').forEach(t=>t.classList.remove('active'));
        var tab=document.querySelector('#tab-'+(name||'daily')); if(tab) tab.classList.add('active');
      }
      function onHash(){var h=location.hash.replace(/^#\/?/,'')||'daily'; show(h);}
      window.addEventListener('hashchange', onHash);
      if(!location.hash) location.hash = '#/daily'; onHash();

      // ë¡œê·¸ì¸ ëª¨ë‹¬ ìµœì†Œ ë™ì‘(íŒŒì´ì–´ë² ì´ìŠ¤ ì´ˆê¸°í™” ì‹¤íŒ¨í•´ë„ ì—´ê³  ë‹«íˆê²Œ)
      var lm=document.getElementById('loginModal');
      var openBtn=document.getElementById('authMiniLogin');
      var openBtn2=document.getElementById('openLogin');
      var closeBtn=document.getElementById('modalClose');
      function open(){ if(lm) lm.classList.add('open'); }
      function close(){ if(lm) lm.classList.remove('open'); }
      if(openBtn) openBtn.addEventListener('click', open);
      if(openBtn2) openBtn2.addEventListener('click', open);
      if(closeBtn) closeBtn.addEventListener('click', close);
      lm && lm.addEventListener('click', function(e){ if(e.target.id==='loginModal') close(); });

      // ì˜¤ëŠ˜ ë‚ ì§œ í‘œì‹œ ê¸°ë³¸ ì„¸íŒ… (JS ì´ˆê¸° ê°€ë™ ë³´ì¥)
      var dd=document.getElementById('dailyDate'); var dt=document.getElementById('dailyDateText');
      try{
        var d=new Date(); var tz=d.getTimezoneOffset()*60000; var ymd=new Date(d.getTime()-tz).toISOString().slice(0,10);
        if(dd){ dd.value=ymd; if(dt){ dt.textContent = d.getFullYear()+'. '+(d.getMonth()+1)+'. '+d.getDate()+'.'; } }
      }catch(e){}
    })();
  </script>
</body>

</html>
